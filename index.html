<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaZi - The Way of Destiny</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(120, 219, 226, 0.05) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
        }
        
        @keyframes backgroundShift {
            0%, 100% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(-20px) translateY(-10px); }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 40px;
            min-height: 100vh;
        }
        
        .main-content {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(120, 119, 198, 0.2);
            border-radius: 8px;
            padding: 40px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .wisdom-panel {
            background: rgba(15, 15, 15, 0.95);
            border: 1px solid rgba(120, 119, 198, 0.3);
            border-radius: 8px;
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            height: fit-content;
            max-height: 90vh;
            position: sticky;
            top: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        
        .header {
            text-align: center;
            margin-bottom: 60px;
            border-bottom: 1px solid rgba(120, 119, 198, 0.2);
            padding-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            color: #ffffff;
            font-weight: 300;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(120, 119, 198, 0.3);
        }
        
        .header .subtitle {
            font-size: 1.1em;
            color: rgba(120, 119, 198, 0.8);
            font-style: italic;
            letter-spacing: 1px;
        }
        
        .wisdom-header {
            background: linear-gradient(135deg, rgba(120, 119, 198, 0.1), rgba(120, 219, 226, 0.1));
            color: #ffffff;
            padding: 30px;
            border-bottom: 1px solid rgba(120, 119, 198, 0.2);
            text-align: center;
        }
        
        .wisdom-header h3 {
            margin-bottom: 8px;
            font-weight: 300;
            font-size: 1.4em;
            letter-spacing: 1px;
        }
        
        .wisdom-header p {
            font-size: 0.9em;
            opacity: 0.8;
            font-style: italic;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 40px;
            border-bottom: 1px solid rgba(120, 119, 198, 0.2);
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 20px 15px;
            cursor: pointer;
            color: rgba(120, 119, 198, 0.7);
            font-weight: 300;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            font-size: 0.95em;
            letter-spacing: 0.5px;
        }
        
        .tab:hover {
            color: rgba(120, 219, 226, 0.9);
            background: rgba(120, 119, 198, 0.05);
        }
        
        .tab.active {
            color: #ffffff;
            border-bottom-color: rgba(120, 219, 226, 0.8);
            background: rgba(120, 119, 198, 0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 300;
            color: rgba(120, 219, 226, 0.9);
            font-size: 0.95em;
            letter-spacing: 0.5px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid rgba(120, 119, 198, 0.3);
            border-radius: 4px;
            color: #ffffff;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: rgba(120, 219, 226, 0.6);
            box-shadow: 0 0 15px rgba(120, 219, 226, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .btn {
            background: linear-gradient(135deg, rgba(120, 119, 198, 0.8), rgba(120, 219, 226, 0.6));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px 5px;
            letter-spacing: 1px;
            font-family: 'Georgia', serif;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(120, 119, 198, 0.3);
            background: linear-gradient(135deg, rgba(120, 119, 198, 1), rgba(120, 219, 226, 0.8));
        }
        
        .chart-container {
            background: rgba(30, 30, 30, 0.6);
            border: 1px solid rgba(120, 119, 198, 0.2);
            border-radius: 8px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .pillars-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .pillar {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(120, 119, 198, 0.3);
            border-radius: 6px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .pillar:hover {
            transform: translateY(-5px);
            border-color: rgba(120, 219, 226, 0.6);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .pillar h4 {
            color: rgba(120, 219, 226, 0.9);
            margin-bottom: 15px;
            font-size: 0.9em;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        .stem-branch {
            margin: 12px 0;
        }
        
        .chinese {
            font-size: 28px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 5px;
        }
        
        .element {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 12px;
            margin: 3px;
            display: inline-block;
            color: white;
            font-weight: 400;
            letter-spacing: 0.5px;
        }
        
        .wood { background: linear-gradient(135deg, #4CAF50, #66BB6A); }
        .fire { background: linear-gradient(135deg, #F44336, #FF7043); }
        .earth { background: linear-gradient(135deg, #FF9800, #FFB74D); }
        .metal { background: linear-gradient(135deg, #9E9E9E, #BDBDBD); }
        .water { background: linear-gradient(135deg, #2196F3, #42A5F5); }
        
        .analysis-section {
            background: rgba(30, 30, 30, 0.5);
            border: 1px solid rgba(120, 119, 198, 0.2);
            border-radius: 6px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .analysis-section h3 {
            color: rgba(120, 219, 226, 0.9);
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(120, 219, 226, 0.3);
            padding-bottom: 8px;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        .wisdom-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            max-height: 400px;
            min-height: 300px;
        }
        
        .message {
            margin-bottom: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            max-width: 90%;
            animation: fadeIn 0.5s ease-in;
            line-height: 1.7;
        }
        
        .user-message {
            background: rgba(120, 119, 198, 0.2);
            color: #ffffff;
            margin-left: auto;
            border: 1px solid rgba(120, 119, 198, 0.3);
        }
        
        .sage-message {
            background: rgba(30, 30, 30, 0.8);
            color: rgba(240, 240, 240, 0.95);
            border: 1px solid rgba(120, 219, 226, 0.2);
            font-style: italic;
            position: relative;
            padding-left: 25px;
        }
        
        .sage-message::before {
            content: '☯';
            position: absolute;
            left: 8px;
            top: 15px;
            color: rgba(120, 219, 226, 0.7);
            font-size: 14px;
        }
        
        .wisdom-input-area {
            padding: 25px;
            border-top: 1px solid rgba(120, 119, 198, 0.2);
        }
        
        .wisdom-input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid rgba(120, 119, 198, 0.3);
            border-radius: 25px;
            color: #ffffff;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }
        
        .wisdom-input:focus {
            border-color: rgba(120, 219, 226, 0.6);
            box-shadow: 0 0 15px rgba(120, 219, 226, 0.1);
        }
        
        .send-btn {
            background: rgba(120, 119, 198, 0.8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            margin-left: 12px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }
        
        .send-btn:hover {
            background: rgba(120, 219, 226, 0.8);
        }
        
        .wisdom-questions {
            margin-bottom: 15px;
        }
        
        .wisdom-question {
            display: inline-block;
            background: rgba(120, 119, 198, 0.1);
            color: rgba(120, 219, 226, 0.8);
            padding: 8px 15px;
            margin: 4px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(120, 119, 198, 0.2);
            font-style: italic;
        }
        
        .wisdom-question:hover {
            background: rgba(120, 119, 198, 0.2);
            color: #ffffff;
            transform: translateY(-1px);
        }
        
        .sage-suggestion {
            background: linear-gradient(135deg, rgba(120, 119, 198, 0.1), rgba(120, 219, 226, 0.05));
            border: 1px solid rgba(120, 219, 226, 0.3);
            border-radius: 6px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-style: italic;
        }
        
        .sage-suggestion:hover {
            background: linear-gradient(135deg, rgba(120, 119, 198, 0.2), rgba(120, 219, 226, 0.1));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .sage-suggestion::before {
            content: '☯';
            position: absolute;
            right: 15px;
            top: 15px;
            color: rgba(120, 219, 226, 0.6);
            font-size: 16px;
        }
        
        .typing-indicator {
            display: none;
            padding: 15px 25px;
            color: rgba(120, 219, 226, 0.7);
            font-style: italic;
            font-size: 14px;
        }
        
        .typing-indicator.show {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px 10px;
            }
            
            .wisdom-panel {
                order: -1;
                position: relative;
                max-height: 60vh;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .pillars-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="background"></div>
    
    <div class="container">
        <div class="main-content">
            <div class="header">
                <h1>八字 The Way of Destiny</h1>
                <p class="subtitle">"Those who know do not speak. Those who speak do not know."</p>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="showTab('chart')">Chart</div>
                <div class="tab" onclick="showTab('elements')">Elements</div>
                <div class="tab" onclick="showTab('compatibility')">Harmony</div>
                <div class="tab" onclick="showTab('luck')">Cycles</div>
                <div class="tab" onclick="showTab('forecast')">Flow</div>
            </div>
            
            <div id="chart" class="tab-content active">
                <h2>The Four Pillars of Being</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Birth Date</label>
                        <input type="date" id="birthDate" value="1990-01-01">
                    </div>
                    <div class="form-group">
                        <label>Birth Time</label>
                        <input type="time" id="birthTime" value="12:00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Gender</label>
                    <select id="gender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <button class="btn" onclick="generateChart()">Reveal the Path</button>
                <div id="chartResult"></div>
            </div>
            
            <div id="elements" class="tab-content">
                <h2>The Dance of Five Elements</h2>
                <p style="margin-bottom: 30px; font-style: italic; color: rgba(120, 219, 226, 0.8);">"In nature, water flows without forcing, yet it overcomes the hardest stone."</p>
                <div class="form-row">
                    <div class="form-group">
                        <label>Birth Date</label>
                        <input type="date" id="elemBirthDate" value="1990-01-01">
                    </div>
                    <div class="form-group">
                        <label>Birth Time</label>
                        <input type="time" id="elemBirthTime" value="12:00">
                    </div>
                </div>
                <button class="btn" onclick="analyzeElements()">Understand the Balance</button>
                <div id="elementResult"></div>
            </div>
            
            <div id="compatibility" class="tab-content">
                <h2>The Harmony of Two Paths</h2>
                <p style="margin-bottom: 30px; font-style: italic; color: rgba(120, 219, 226, 0.8);">"When two hearts beat in harmony, even the universe listens."</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                    <div>
                        <h3>First Path</h3>
                        <div class="form-group">
                            <label>Birth Date</label>
                            <input type="date" id="person1Date" value="1990-01-01">
                        </div>
                        <div class="form-group">
                            <label>Birth Time</label>
                            <input type="time" id="person1Time" value="12:00">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select id="person1Gender">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <h3>Second Path</h3>
                        <div class="form-group">
                            <label>Birth Date</label>
                            <input type="date" id="person2Date" value="1992-06-01">
                        </div>
                        <div class="form-group">
                            <label>Birth Time</label>
                            <input type="time" id="person2Time" value="14:00">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select id="person2Gender">
                                <option value="female">Female</option>
                                <option value="male">Male</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="checkCompatibility()">Seek the Harmony</button>
                <div id="compatibilityResult"></div>
            </div>
            
            <div id="luck" class="tab-content">
                <h2>The Eternal Cycles</h2>
                <p style="margin-bottom: 30px; font-style: italic; color: rgba(120, 219, 226, 0.8);">"Like seasons, life flows in cycles. The wise understand and flow with them."</p>
                <div class="form-row">
                    <div class="form-group">
                        <label>Birth Date</label>
                        <input type="date" id="luckBirthDate" value="1990-01-01">
                    </div>
                    <div class="form-group">
                        <label>Birth Time</label>
                        <input type="time" id="luckBirthTime" value="12:00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Gender</label>
                    <select id="luckGender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <button class="btn" onclick="calculateLuck()">Understand the Seasons</button>
                <div id="luckResult"></div>
            </div>
            
            <div id="forecast" class="tab-content">
                <h2>The River of Time</h2>
                <p style="margin-bottom: 30px; font-style: italic; color: rgba(120, 219, 226, 0.8);">"Yesterday is history, tomorrow is mystery. Today is a gift."</p>
                <div class="form-row">
                    <div class="form-group">
                        <label>Your Birth Date</label>
                        <input type="date" id="forecastBirthDate" value="1990-01-01">
                    </div>
                    <div class="form-group">
                        <label>Your Birth Time</label>
                        <input type="time" id="forecastBirthTime" value="12:00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Time Window</label>
                    <select id="forecastPeriod">
                        <option value="daily">Seven Days</option>
                        <option value="monthly">Six Moons</option>
                    </select>
                </div>
                <button class="btn" onclick="generateForecast()">Read the Currents</button>
                <div id="forecastResult"></div>
            </div>
        </div>
        
        <div class="wisdom-panel">
            <div class="wisdom-header">
                <h3>☯ The Sage Speaks</h3>
                <p>"Ask, and the Way shall be revealed to you"</p>
            </div>
            
            <div class="wisdom-messages" id="wisdomMessages">
                <div class="message sage-message">
                    Greetings, seeker. I am here to guide you through the ancient wisdom of the Four Pillars. Like water that shapes stone through patience, understanding comes to those who ask with an open heart.
                    
                    <div class="wisdom-questions">
                        <div class="wisdom-question" onclick="askWisdom('What is my essence?')">What is my essence?</div>
                        <div class="wisdom-question" onclick="askWisdom('The elemental dance?')">The elemental dance?</div>
                        <div class="wisdom-question" onclick="askWisdom('My destined path?')">My destined path?</div>
                        <div class="wisdom-question" onclick="askWisdom('Seek harmony')">Seek harmony</div>
                    </div>
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                ☯ The sage contemplates...
            </div>
            
            <div class="wisdom-input-area">
                <div style="display: flex; align-items: center;">
                    <input type="text" id="wisdomInput" class="wisdom-input" placeholder="Speak your question to the sage..." onkeypress="handleWisdomKeyPress(event)">
                    <button class="send-btn" onclick="sendWisdom()">Ask</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const HEAVENLY_STEMS = {
            0: {chinese: '甲', element: 'wood', yin_yang: 'yang'},
            1: {chinese: '乙', element: 'wood', yin_yang: 'yin'},
            2: {chinese: '丙', element: 'fire', yin_yang: 'yang'},
            3: {chinese: '丁', element: 'fire', yin_yang: 'yin'},
            4: {chinese: '戊', element: 'earth', yin_yang: 'yang'},
            5: {chinese: '己', element: 'earth', yin_yang: 'yin'},
            6: {chinese: '庚', element: 'metal', yin_yang: 'yang'},
            7: {chinese: '辛', element: 'metal', yin_yang: 'yin'},
            8: {chinese: '壬', element: 'water', yin_yang: 'yang'},
            9: {chinese: '癸', element: 'water', yin_yang: 'yin'}
        };

        const EARTHLY_BRANCHES = {
            0: {chinese: '子', element: 'water', animal: 'Rat'},
            1: {chinese: '丑', element: 'earth', animal: 'Ox'},
            2: {chinese: '寅', element: 'wood', animal: 'Tiger'},
            3: {chinese: '卯', element: 'wood', animal: 'Rabbit'},
            4: {chinese: '辰', element: 'earth', animal: 'Dragon'},
            5: {chinese: '巳', element: 'fire', animal: 'Snake'},
            6: {chinese: '午', element: 'fire', animal: 'Horse'},
            7: {chinese: '未', element: 'earth', animal: 'Goat'},
            8: {chinese: '申', element: 'metal', animal: 'Monkey'},
            9: {chinese: '酉', element: 'metal', animal: 'Rooster'},
            10: {chinese: '戌', element: 'earth', animal: 'Dog'},
            11: {chinese: '亥', element: 'water', animal: 'Pig'}
        };

        let currentChart = null;

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function calculateBaZi(birthDate, birthTime) {
            const date = new Date(birthDate + 'T' + birthTime);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hour = date.getHours();

            const yearStemIndex = (year - 4) % 10;
            const yearBranchIndex = (year - 4) % 12;
            const monthStemIndex = (yearStemIndex * 2 + month) % 10;
            const monthBranchIndex = (month + 1) % 12;
            const dayStemIndex = ((year - 1900) * 365 + Math.floor((year - 1900) / 4) + day) % 10;
            const dayBranchIndex = ((year - 1900) * 365 + Math.floor((year - 1900) / 4) + day) % 12;
            const hourStemIndex = (dayStemIndex * 2 + Math.floor(hour / 2)) % 10;
            const hourBranchIndex = Math.floor(hour / 2) % 12;

            return {
                year: {
                    stem: HEAVENLY_STEMS[yearStemIndex],
                    branch: EARTHLY_BRANCHES[yearBranchIndex]
                },
                month: {
                    stem: HEAVENLY_STEMS[monthStemIndex],
                    branch: EARTHLY_BRANCHES[monthBranchIndex]
                },
                day: {
                    stem: HEAVENLY_STEMS[dayStemIndex],
                    branch: EARTHLY_BRANCHES[dayBranchIndex]
                },
                hour: {
                    stem: HEAVENLY_STEMS[hourStemIndex],
                    branch: EARTHLY_BRANCHES[hourBranchIndex]
                }
            };
        }

        function getPersonalityTraits(element, yinYang) {
            const traits = {
                wood: {
                    yang: "Like the mighty oak - creative, ambitious, pioneering, with the patience of growth",
                    yin: "Like flowing bamboo - gentle, flexible, artistic, diplomatic in nature"
                },
                fire: {
                    yang: "Like the bright sun - energetic, charismatic, passionate, illuminating all around",
                    yin: "Like gentle candlelight - warm, intuitive, spiritual, bringing quiet wisdom"
                },
                earth: {
                    yang: "Like the eternal mountain - stable, reliable, practical, providing foundation",
                    yin: "Like fertile soil - nurturing, patient, supportive, attending to details"
                },
                metal: {
                    yang: "Like forged steel - strong-willed, organized, decisive, upholding justice",
                    yin: "Like precious jade - precise, elegant, perfectionist, seeking quality"
                },
                water: {
                    yang: "Like the vast ocean - adaptable, intelligent, resourceful, communicating depths",
                    yin: "Like morning dew - wise, intuitive, mysterious, contemplating profundity"
                }
            };
            return traits[element][yinYang];
        }

        function getSageWisdom(element) {
            const wisdom = {
                wood: "Ah, the Wood essence flows within you. Like the great tree that bends with the storm yet never breaks, you carry the wisdom of growth and renewal. Yang Wood is the mighty oak - ambitious and reaching skyward. Yin Wood is the flexible bamboo - yielding yet unbreakable. Both understand that true strength comes not from rigidity, but from the ability to grow toward the light.",
                fire: "The Fire spirit burns bright in your being. Like the sun that gives life to all things without asking for gratitude, you possess the gift of illumination. Yang Fire burns like the eternal flame - passionate and illuminating the world. Yin Fire glows like the gentle candle - bringing warmth and wisdom to intimate spaces. Remember, the flame that burns brightest often consumes itself first.",
                earth: "The Earth element grounds your spirit in eternal wisdom. Like the mountain that stands unmoved by wind and rain, you embody stability and patience. Yang Earth is the mighty mountain - reliable and enduring. Yin Earth is the fertile valley - nurturing and supportive. Both understand that in stillness, all movement is possible.",
                metal: "The Metal essence shapes your character with precision and clarity. Like the sword that cuts through illusion to reveal truth, you possess the gift of discernment. Yang Metal is the blade of justice - direct and unwavering. Yin Metal is the precious jewel - refined and beautiful. Both understand that true value comes from purity of purpose.",
                water: "The Water spirit flows through your being with infinite wisdom. Like the river that always finds its way to the sea, you understand the power of persistence through yielding. Yang Water is the vast ocean - deep and mysterious. Yin Water is the gentle stream - quiet yet persistent. Both know that the softest thing in the world overcomes the hardest."
            };
            return wisdom[element] || "Each element carries its own profound wisdom for those who listen with open hearts.";
        }

        function getPillarWisdom(pillarType) {
            const wisdom = {
                year: "The Year Pillar reveals how the world first knew you - the mask you wear in society's grand theater. It speaks of your ancestors' gifts and burdens, the karma inherited and the destiny to be transformed. Like the roots of a tree, it grounds you in the earth of your beginnings.",
                month: "The Month Pillar illuminates your working spirit - how you engage with the world in the prime of your power. Here dwells your relationship with career, achievement, and the bonds that sustain you through life's seasons. It is the trunk of your existence, strong and visible to all.",
                day: "The Day Pillar is your truest self - the core that remains when all masks are removed. This is your essence, your inner nature, the seed from which all your other aspects grow. Like the heartwood of the tree, it gives structure to everything else. To know this pillar is to know yourself.",
                hour: "The Hour Pillar whispers of your hidden depths - your private thoughts, your children's potential, and how you will meet old age. It is the crown of your tree, reaching toward heaven, speaking to the legacy you will leave and the wisdom you will gather in your final seasons."
            };
            return wisdom[pillarType] || "Each pillar holds its own sacred teachings.";
        }

        function generateChart() {
            const birthDate = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;
            const gender = document.getElementById('gender').value;

            const chart = calculateBaZi(birthDate, birthTime);
            currentChart = chart;

            const resultDiv = document.getElementById('chartResult');
            resultDiv.innerHTML = `
                <div class="chart-container">
                    <h3>Your Four Pillars Revealed</h3>
                    <div class="pillars-grid">
                        <div class="pillar" onclick="explainPillar('year')">
                            <h4>Year Pillar</h4>
                            <div class="stem-branch">
                                <div class="chinese">${chart.year.stem.chinese}</div>
                                <div class="element ${chart.year.stem.element}">${chart.year.stem.element.toUpperCase()}</div>
                            </div>
                            <div class="stem-branch">
                                <div class="chinese">${chart.year.branch.chinese}</div>
                                <div class="element ${chart.year.branch.element}">${chart.year.branch.element.toUpperCase()}</div>
                                <div style="font-size: 11px; margin-top: 5px; color: rgba(120, 219, 226, 0.7);">${chart.year.branch.animal}</div>
                            </div>
                        </div>
                        <div class="pillar" onclick="explainPillar('month')">
                            <h4>Month Pillar</h4>
                            <div class="stem-branch">
                                <div class="chinese">${chart.month.stem.chinese}</div>
                                <div class="element ${chart.month.stem.element}">${chart.month.stem.element.toUpperCase()}</div>
                            </div>
                            <div class="stem-branch">
                                <div class="chinese">${chart.month.branch.chinese}</div>
                                <div class="element ${chart.month.branch.element}">${chart.month.branch.element.toUpperCase()}</div>
                                <div style="font-size: 11px; margin-top: 5px; color: rgba(120, 219, 226, 0.7);">${chart.month.branch.animal}</div>
                            </div>
                        </div>
                        <div class="pillar" onclick="explainPillar('day')">
                            <h4>Day Pillar ☯</h4>
                            <div class="stem-branch">
                                <div class="chinese">${chart.day.stem.chinese}</div>
                                <div class="element ${chart.day.stem.element}">${chart.day.stem.element.toUpperCase()}</div>
                            </div>
                            <div class="stem-branch">
                                <div class="chinese">${chart.day.branch.chinese}</div>
                                <div class="element ${chart.day.branch.element}">${chart.day.branch.element.toUpperCase()}</div>
                                <div style="font-size: 11px; margin-top: 5px; color: rgba(120, 219, 226, 0.7);">${chart.day.branch.animal}</div>
                            </div>
                        </div>
                        <div class="pillar" onclick="explainPillar('hour')">
                            <h4>Hour Pillar</h4>
                            <div class="stem-branch">
                                <div class="chinese">${chart.hour.stem.chinese}</div>
                                <div class="element ${chart.hour.stem.element}">${chart.hour.stem.element.toUpperCase()}</div>
                            </div>
                            <div class="stem-branch">
                                <div class="chinese">${chart.hour.branch.chinese}</div>
                                <div class="element ${chart.hour.branch.element}">${chart.hour.branch.element.toUpperCase()}</div>
                                <div style="font-size: 11px; margin-top: 5px; color: rgba(120, 219, 226, 0.7);">${chart.hour.branch.animal}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analysis-section">
                        <h3>The Pattern Revealed</h3>
                        <p><strong>Your Essence (Day Master):</strong> ${chart.day.stem.chinese} (${chart.day.stem.element.toUpperCase()}) - The core of your being</p>
                        <p><strong>Natural Expression:</strong> ${getPersonalityTraits(chart.day.stem.element, chart.day.stem.yin_yang)}</p>
                    </div>
                    
                    <div class="sage-suggestion" onclick="askWisdom('Reveal the deeper meaning of my Four Pillars')">
                        ☯ "The sage says: Click here to understand the deeper currents of your destiny"
                    </div>
                </div>
            `;

            setTimeout(() => {
                addSageMessage(`Ah, the celestial patterns align to reveal your path. Your essence is ${chart.day.stem.chinese} (${chart.day.stem.element.toUpperCase()}), and I see the dance of elements within your being.

${getSageWisdom(chart.day.stem.element)}

Touch any pillar above to hear its whispered secrets, or ask me to illuminate the shadows of your destiny.`);
            }, 1000);
        }

        function explainPillar(pillarType) {
            if (!currentChart) {
                addSageMessage("First, child, reveal your Four Pillars so that I may read the language of heaven in your chart.");
                return;
            }
            
            const pillar = currentChart[pillarType];
            const message = `Speak to me of my ${pillarType} pillar`;
            addUserMessage(message);
            
            setTimeout(() => {
                let response = `The ${pillarType.toUpperCase()} PILLAR: ${pillar.stem.chinese}${pillar.branch.chinese}\n\n`;
                response += `${getPillarWisdom(pillarType)}\n\n`;
                response += `Within this pillar dwells:\n`;
                response += `• ${pillar.stem.chinese} - the ${pillar.stem.element} essence in its ${pillar.stem.yin_yang} form\n`;
                response += `• ${pillar.branch.chinese} - the ${pillar.branch.element} energy of the ${pillar.branch.animal}\n\n`;
                
                if (pillarType === 'day') {
                    response += `☯ This pillar holds your truest self - your Day Master.\n`;
                    response += `${getSageWisdom(pillar.stem.element)}`;
                }
                
                addSageMessage(response);
            }, 1200);
        }

        function addUserMessage(message) {
            const wisdomMessages = document.getElementById('wisdomMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            messageDiv.textContent = message;
            wisdomMessages.appendChild(messageDiv);
            wisdomMessages.scrollTop = wisdomMessages.scrollHeight;
        }

        function addSageMessage(message) {
            const wisdomMessages = document.getElementById('wisdomMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message sage-message';
            messageDiv.innerHTML = message.replace(/\n/g, '<br>');
            wisdomMessages.appendChild(messageDiv);
            wisdomMessages.scrollTop = wisdomMessages.scrollHeight;
        }

        function showTyping() {
            document.getElementById('typingIndicator').classList.add('show');
        }

        function hideTyping() {
            document.getElementById('typingIndicator').classList.remove('show');
        }

        function sendWisdom() {
            const input = document.getElementById('wisdomInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addUserMessage(message);
            input.value = '';
            
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                const response = generateSageResponse(message);
                addSageMessage(response);
            }, 1500 + Math.random() * 1500);
        }

        function askWisdom(question) {
            addUserMessage(question);
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                const response = generateSageResponse(question);
                addSageMessage(response);
            }, 1200);
        }

        function handleWisdomKeyPress(event) {
            if (event.key === 'Enter') {
                sendWisdom();
            }
        }

        function generateSageResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (currentChart) {
                if (message.includes('essence') || message.includes('day master') || message.includes('nature')) {
                    const dayMaster = currentChart.day.stem;
                    return `Your essence is ${dayMaster.chinese}, the ${dayMaster.element} in its ${dayMaster.yin_yang} form. 

${getSageWisdom(dayMaster.element)}

Remember, child - you are not your chart, but the consciousness that observes it. The chart reveals tendencies, not absolutes. The Tao flows through all patterns yet remains beyond them.`;
                }
                
                if (message.includes('path') || message.includes('destiny') || message.includes('reveal') || message.includes('deeper')) {
                    return `☯ The Deep Currents of Your Destiny ☯

Your Four Pillars sing this song:
Year: ${currentChart.year.stem.chinese}${currentChart.year.branch.chinese} - how the world first knew you
Month: ${currentChart.month.stem.chinese}${currentChart.month.branch.chinese} - your worldly engagement  
Day: ${currentChart.day.stem.chinese}${currentChart.day.branch.chinese} - your eternal essence ☯
Hour: ${currentChart.hour.stem.chinese}${currentChart.hour.branch.chinese} - your hidden depths

${getSageWisdom(currentChart.day.stem.element)}

Remember - these are tendencies, not chains. The truly awakened person transcends their chart while honoring its wisdom. You are both the river and the consciousness that observes its flow.`;
                }
                
                if (message.includes('harmony') || message.includes('balance')) {
                    return `True harmony comes not from perfection but from acceptance. Like a garden where different flowers bloom in their own season, your elements each have their time and purpose.

The Tao teaches us: Water does not compete with fire for dominance, yet together they create the mist that nourishes all life.

To find balance, neither suppress your challenging elements nor cling to your strong ones. Simply observe them with compassion, like a sage watching clouds pass across the sky.`;
                }
            }
            
            const sageResponses = [
                "The Tao that can be spoken is not the eternal Tao. Your question points to a truth that words cannot fully capture. Sit quietly with your chart, and let understanding arise naturally.",
                "Like water seeking its course, your question flows toward wisdom. Yet sometimes the most profound answers come not from words but from silent contemplation of the patterns heaven has written in your being.",
                "The sage teaches without teaching, leads without leading. Your chart is a mirror - it shows not what you must become, but what you already are. Look deeper, and you will find what you seek.",
                "The wise person asks not what their destiny holds, but how to align with the natural flow of existence. Generate your chart first, and I will help you read the language of heaven written in your birth moment."
            ];
            
            return sageResponses[Math.floor(Math.random() * sageResponses.length)];
        }

        // Simple placeholder functions for other tabs
        function analyzeElements() {
            addSageMessage("The elemental analysis awaits your chart. First, generate your Four Pillars in the Chart tab, then return here for deeper understanding.");
        }

        function checkCompatibility() {
            addSageMessage("The harmony of two paths requires both charts to be revealed. Generate individual charts first, then seek the wisdom of compatibility.");
        }

        function calculateLuck() {
            addSageMessage("The cycles of fortune flow from your birth patterns. Create your chart first, then I shall reveal the seasons of your destiny.");
        }

        function generateForecast() {
            addSageMessage("The currents of time are read through your celestial blueprint. Generate your chart first, then I can forecast the flowing energies.");
        }

        window.addEventListener('load', function() {
            setTimeout(() => {
                addSageMessage(`Welcome, seeker of wisdom. I am here to guide you through the ancient art of the Four Pillars, as water guides the river to the sea.

The charts you create reveal not your fate, but your nature. Like the moon reflected in still water, your true self can be seen when the mind becomes quiet.

Begin by revealing your Four Pillars, then return to sit with me in contemplation. The greatest truths are found not in complex calculations, but in simple understanding.

"The journey of a thousand miles begins with a single step."`);
            }, 500);
        });
    </script>()}), and I see the dance of elements within your being.

${getSageWisdom(chart.day.stem.element)}

Touch any pillar above to hear its whispered secrets, or ask me to illuminate the shadows of your destiny.`);
            }, 1000);
        }

        function explainPillar(pillarType) {
            if (!currentChart) {
                addSageMessage("First, child, reveal your Four Pillars so that I may read the language of heaven in your chart.");
                return;
            }
            
            const pillar = currentChart[pillarType];
            const message = `Speak to me of my ${pillarType} pillar`;
            addUserMessage(message);
            
            setTimeout(() => {
                let response = `The ${pillarType.toUpperCase()} PILLAR: ${pillar.stem.chinese}${pillar.branch.chinese}\n\n`;
                response += `${getPillarWisdom(pillarType)}\n\n`;
                response += `Within this pillar dwells:\n`;
                response += `• ${pillar.stem.chinese} - the ${pillar.stem.element} essence in its ${pillar.stem.yin_yang} form\n`;
                response += `• ${pillar.branch.chinese} - the ${pillar.branch.element} energy of the ${pillar.branch.animal}\n\n`;
                
                if (pillarType === 'day') {
                    response += `☯ This pillar holds your truest self - your Day Master.\n`;
                    response += `${getSageWisdom(pillar.stem.element)}`;
                }
                
                addSageMessage(response);
            }, 1200);
        }

        function getPersonalityTraits(element, yinYang) {
            const traits = {
                wood: {
                    yang: "Like the mighty oak - creative, ambitious, pioneering, with the patience of growth",
                    yin: "Like flowing bamboo - gentle, flexible, artistic, diplomatic in nature"
                },
                fire: {
                    yang: "Like the bright sun - energetic, charismatic, passionate, illuminating all around",
                    yin: "Like gentle candlelight - warm, intuitive, spiritual, bringing quiet wisdom"
                },
                earth: {
                    yang: "Like the eternal mountain - stable, reliable, practical, providing foundation",
                    yin: "Like fertile soil - nurturing, patient, supportive, attending to details"
                },
                metal: {
                    yang: "Like forged steel - strong-willed, organized, decisive, upholding justice",
                    yin: "Like precious jade - precise, elegant, perfectionist, seeking quality"
                },
                water: {
                    yang: "Like the vast ocean - adaptable, intelligent, resourceful, communicating depths",
                    yin: "Like morning dew - wise, intuitive, mysterious, contemplating profundity"
                }
            };
            return traits[element][yinYang];
        }

        function getSageWisdom(element) {
            const wisdom = {
                wood: "Ah, the Wood essence flows within you. Like the great tree that bends with the storm yet never breaks, you carry the wisdom of growth and renewal. Yang Wood is the mighty oak - ambitious and reaching skyward. Yin Wood is the flexible bamboo - yielding yet unbreakable. Both understand that true strength comes not from rigidity, but from the ability to grow toward the light.",
                fire: "The Fire spirit burns bright in your being. Like the sun that gives life to all things without asking for gratitude, you possess the gift of illumination. Yang Fire burns like the eternal flame - passionate and illuminating the world. Yin Fire glows like the gentle candle - bringing warmth and wisdom to intimate spaces. Remember, the flame that burns brightest often consumes itself first.",
                earth: "The Earth element grounds your spirit in eternal wisdom. Like the mountain that stands unmoved by wind and rain, you embody stability and patience. Yang Earth is the mighty mountain - reliable and enduring. Yin Earth is the fertile valley - nurturing and supportive. Both understand that in stillness, all movement is possible.",
                metal: "The Metal essence shapes your character with precision and clarity. Like the sword that cuts through illusion to reveal truth, you possess the gift of discernment. Yang Metal is the blade of justice - direct and unwavering. Yin Metal is the precious jewel - refined and beautiful. Both understand that true value comes from purity of purpose.",
                water: "The Water spirit flows through your being with infinite wisdom. Like the river that always finds its way to the sea, you understand the power of persistence through yielding. Yang Water is the vast ocean - deep and mysterious. Yin Water is the gentle stream - quiet yet persistent. Both know that the softest thing in the world overcomes the hardest."
            };
            return wisdom[element] || "Each element carries its own profound wisdom for those who listen with open hearts.";
        }

        function getPillarWisdom(pillarType) {
            const wisdom = {
                year: "The Year Pillar reveals how the world first knew you - the mask you wear in society's grand theater. It speaks of your ancestors' gifts and burdens, the karma inherited and the destiny to be transformed. Like the roots of a tree, it grounds you in the earth of your beginnings.",
                month: "The Month Pillar illuminates your working spirit - how you engage with the world in the prime of your power. Here dwells your relationship with career, achievement, and the bonds that sustain you through life's seasons. It is the trunk of your existence, strong and visible to all.",
                day: "The Day Pillar is your truest self - the core that remains when all masks are removed. This is your essence, your inner nature, the seed from which all your other aspects grow. Like the heartwood of the tree, it gives structure to everything else. To know this pillar is to know yourself.",
                hour: "The Hour Pillar whispers of your hidden depths - your private thoughts, your children's potential, and how you will meet old age. It is the crown of your tree, reaching toward heaven, speaking to the legacy you will leave and the wisdom you will gather in your final seasons."
            };
            return wisdom[pillarType] || "Each pillar holds its own sacred teachings.";
        }

        function addUserMessage(message) {
            const wisdomMessages = document.getElementById('wisdomMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            messageDiv.textContent = message;
            wisdomMessages.appendChild(messageDiv);
            wisdomMessages.scrollTop = wisdomMessages.scrollHeight;
        }

        function addSageMessage(message) {
            const wisdomMessages = document.getElementById('wisdomMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message sage-message';
            messageDiv.innerHTML = message.replace(/\n/g, '<br>');
            wisdomMessages.appendChild(messageDiv);
            wisdomMessages.scrollTop = wisdomMessages.scrollHeight;
        }

        function showTyping() {
            document.getElementById('typingIndicator').classList.add('show');
        }

        function hideTyping() {
            document.getElementById('typingIndicator').classList.remove('show');
        }

        function sendWisdom() {
            const input = document.getElementById('wisdomInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addUserMessage(message);
            input.value = '';
            
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                const response = generateSageResponse(message);
                addSageMessage(response);
            }, 1500 + Math.random() * 1500);
        }

        function askWisdom(question) {
            addUserMessage(question);
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                const response = generateSageResponse(question);
                addSageMessage(response);
            }, 1200);
        }

        function handleWisdomKeyPress(event) {
            if (event.key === 'Enter') {
                sendWisdom();
            }
        }

        function analyzeElements() {
            const birthDate = document.getElementById('elemBirthDate').value;
            const birthTime = document.getElementById('elemBirthTime').value;
            
            const chart = calculateBaZi(birthDate, birthTime);
            currentChart = chart;
            const analysis = calculateElementStrengths(chart);
            
            const resultDiv = document.getElementById('elementResult');
            resultDiv.innerHTML = `
                <div class="analysis-section">
                    <h3>The Elemental Dance Within</h3>
                    ${Object.keys(analysis.strengths).map(element => `
                        <div style="display: flex; justify-content: space-between; margin: 15px 0; align-items: center;">
                            <span><strong>${element.toUpperCase()}:</strong></span>
                            <div style="width: 200px; height: 8px; background: rgba(60, 60, 60, 0.8); border-radius: 4px; overflow: hidden; border: 1px solid rgba(120, 119, 198, 0.2);">
                                <div class="element ${element}" style="height: 100%; width: ${analysis.strengths[element]}%; border-radius: 4px; transition: width 0.8s ease;"></div>
                            </div>
                            <span>${analysis.strengths[element]}%</span>
                        </div>
                    `).join('')}
                </div>
                <div class="analysis-section">
                    <h3>The Flow of Harmony</h3>
                    <div style="background: rgba(76, 175, 80, 0.1); color: rgba(200, 230, 201, 0.9); border-left: 4px solid rgba(76, 175, 80, 0.6); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <strong>Harmonious Energies:</strong> ${analysis.favorable.join(', ').toUpperCase()}
                        <br><em>These elements support your natural flow.</em>
                    </div>
                    <div style="background: rgba(255, 152, 0, 0.1); color: rgba(255, 224, 178, 0.9); border-left: 4px solid rgba(255, 152, 0, 0.6); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <strong>Challenging Currents:</strong> ${analysis.unfavorable.join(', ').toUpperCase()}
                        <br><em>These elements offer lessons in adaptation.</em>
                    </div>
                </div>
                <div class="analysis-section">
                    <h3>The Way of Balance</h3>
                    <p><strong>Colors of harmony:</strong> ${getElementColors(analysis.favorable)}</p>
                    <p><strong>Directions of flow:</strong> ${getElementDirections(analysis.favorable)}</p>
                    <p><strong>Paths of service:</strong> ${getElementCareers(analysis.favorable)}</p>
                </div>
                
                <div class="sage-suggestion" onclick="askWisdom('How can I bring my elements into harmony?')">
                    ☯ "Ask the sage: How can I bring my elements into perfect balance?"
                </div>
            `;
        }

        function calculateElementStrengths(chart) {
            const elements = [
                chart.year.stem.element, chart.year.branch.element,
                chart.month.stem.element, chart.month.branch.element,
                chart.day.stem.element, chart.day.branch.element,
                chart.hour.stem.element, chart.hour.branch.element
            ];

            const elementCount = {wood: 0, fire: 0, earth: 0, metal: 0, water: 0};
            elements.forEach(elem => elementCount[elem]++);

            const total = elements.length;
            const strengths = {};
            Object.keys(elementCount).forEach(elem => {
                strengths[elem] = Math.round((elementCount[elem] / total) * 100);
            });

            const dayMaster = chart.day.stem.element;
            const strongElements = Object.keys(elementCount).filter(elem => elementCount[elem] >= 2);
            const isDayMasterStrong = strongElements.includes(dayMaster);

            let favorable = [];
            let unfavorable = [];

            if (isDayMasterStrong) {
                favorable.push('fire', 'earth'); // elements that help discharge excess
                unfavorable = strongElements.filter(elem => elem !== dayMaster);
            } else {
                favorable.push(dayMaster, 'water'); // elements that support
                unfavorable.push('metal'); // elements that drain
            }

            return {strengths, favorable: [...new Set(favorable)], unfavorable: [...new Set(unfavorable)]};
        }

        function getElementColors(elements) {
            const colors = {
                wood: 'Deep green, soft blue',
                fire: 'Crimson, golden orange',
                earth: 'Warm yellow, rich brown',
                metal: 'Pure white, gleaming silver',
                water: 'Midnight black, ocean blue'
            };
            return elements.map(elem => colors[elem]).join(', ');
        }

        function getElementDirections(elements) {
            const directions = {
                wood: 'East (sunrise), Southeast (growth)',
                fire: 'South (zenith)',
                earth: 'Center (grounding), Southwest & Northeast (stability)',
                metal: 'West (sunset), Northwest (clarity)',
                water: 'North (depth)'
            };
            return elements.map(elem => directions[elem]).join(', ');
        }

        function getElementCareers(elements) {
            const careers = {
                wood: 'Teaching, healing, forestry, writing',
                fire: 'Leadership, entertainment, technology, inspiration',
                earth: 'Real estate, agriculture, counseling, hospitality',
                metal: 'Finance, engineering, law, precision crafts',
                water: 'Research, transportation, communication, spirituality'
            };
            return elements.map(elem => careers[elem]).join(', ');
        }

        function checkCompatibility() {
            const person1Date = document.getElementById('person1Date').value;
            const person1Time = document.getElementById('person1Time').value;
            const person1Gender = document.getElementById('person1Gender').value;
            
            const person2Date = document.getElementById('person2Date').value;
            const person2Time = document.getElementById('person2Time').value;
            const person2Gender = document.getElementById('person2Gender').value;

            const chart1 = calculateBaZi(person1Date, person1Time);
            const chart2 = calculateBaZi(person2Date, person2Time);

            const compatibility = calculateCompatibility(chart1, chart2);

            const resultDiv = document.getElementById('compatibilityResult');
            resultDiv.innerHTML = `
                <div style="background: rgba(30, 30, 30, 0.6); border: 1px solid rgba(120, 119, 198, 0.2); border-radius: 6px; padding: 20px; margin: 15px 0;">
                    <h3>The Dance of Two Paths</h3>
                    <div style="margin: 10px 0;">
                        <strong>Harmony Rating: </strong>
                        ${generateStarRating(compatibility.overall)}
                        <span>(${compatibility.overall}/5 stars)</span>
                    </div>
                    <div class="analysis-section">
                        <h4>Elemental Harmony</h4>
                        <p>${compatibility.elementAnalysis}</p>
                        <div style="margin: 10px 0;">
                            Element Flow: ${generateStarRating(compatibility.elementRating)}
                        </div>
                    </div>
                    <div class="analysis-section">
                        <h4>Animal Wisdom</h4>
                        <p>First path: ${chart1.year.branch.animal} | Second path: ${chart2.year.branch.animal}</p>
                        <p>${compatibility.animalAnalysis}</p>
                        <div style="margin: 10px 0;">
                            Animal Harmony: ${generateStarRating(compatibility.animalRating)}
                        </div>
                    </div>
                    <div class="analysis-section">
                        <h4>The Way Forward</h4>
                        <ul>
                            ${compatibility.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="sage-suggestion" onclick="askWisdom('Guide us to deeper harmony in our relationship')">
                        ☯ "Seek the sage's counsel on the path of relationship harmony"
                    </div>
                </div>
            `;
        }

        function calculateCompatibility(chart1, chart2) {
            const dayMaster1 = chart1.day.stem.element;
            const dayMaster2 = chart2.day.stem.element;
            const animal1 = chart1.year.branch.animal;
            const animal2 = chart2.year.branch.animal;

            let elementRating = 3;
            let elementAnalysis = '';
            
            if (dayMaster1 === 'wood' && dayMaster2 === 'fire' || dayMaster1 === 'fire' && dayMaster2 === 'wood') {
                elementRating = 5;
                elementAnalysis = `Perfect harmony flows between you. Wood nourishes Fire, creating natural support and growth.`;
            } else if (dayMaster1 === dayMaster2) {
                elementRating = 4;
                elementAnalysis = `Kindred spirits walk the same elemental path. You understand each other deeply.`;
            } else if (dayMaster1 === 'metal' && dayMaster2 === 'wood' || dayMaster1 === 'wood' && dayMaster2 === 'metal') {
                elementRating = 2;
                elementAnalysis = `Challenging dynamics require wisdom. Your elements create tension that can forge strength.`;
            } else {
                elementRating = 3;
                elementAnalysis = `Neutral elemental flow allows for balanced relationship through conscious choice.`;
            }

            const animalCompatibility = {
                'Rat': ['Dragon', 'Monkey', 'Ox'],
                'Ox': ['Snake', 'Rooster', 'Rat'],
                'Tiger': ['Horse', 'Dog', 'Pig'],
                'Rabbit': ['Goat', 'Pig', 'Dog'],
                'Dragon': ['Rat', 'Monkey', 'Rooster'],
                'Snake': ['Ox', 'Rooster', 'Monkey'],
                'Horse': ['Tiger', 'Dog', 'Goat'],
                'Goat': ['Rabbit', 'Pig', 'Horse'],
                'Monkey': ['Rat', 'Dragon', 'Snake'],
                'Rooster': ['Ox', 'Snake', 'Dragon'],
                'Dog': ['Tiger', 'Horse', 'Rabbit'],
                'Pig': ['Rabbit', 'Goat', 'Tiger']
            };

            let animalRating = 3;
            let animalAnalysis = '';

            if (animalCompatibility[animal1]?.includes(animal2)) {
                animalRating = 5;
                animalAnalysis = `The celestial animals smile upon your union. ${animal1} and ${animal2} are natural allies.`;
            } else if (animal1 === animal2) {
                animalRating = 4;
                animalAnalysis = `Twin spirits sharing the same animal nature. You understand each other's rhythms naturally.`;
            } else {
                animalRating = 3;
                animalAnalysis = `Different animal energies can create interesting dynamics. Focus on appreciating unique gifts.`;
            }

            const overall = Math.round((elementRating + animalRating) / 2);

            const recommendations = [
                `Honor each other's natural rhythms - like seasons, each has perfect timing`,
                `Communicate with patience - understanding grows slowly like ancient trees`,
                `Create harmony with shared spaces that honor both your elements`,
                overall >= 4 ? `Your natural compatibility is a gift - tend it like a sacred garden` : `Challenges are teachers in disguise - grow stronger through conscious understanding`
            ];

            return {
                overall,
                elementRating,
                elementAnalysis,
                animalRating,
                animalAnalysis,
                recommendations
            };
        }

        function generateStarRating(rating) {
            return '★'.repeat(rating) + '☆'.repeat(5 - rating);
        }

        function calculateLuck() {
            const birthDate = document.getElementById('luckBirthDate').value;
            const birthTime = document.getElementById('luckBirthTime').value;
            const gender = document.getElementById('luckGender').value;

            const chart = calculateBaZi(birthDate, birthTime);
            currentChart = chart;
            const luckPeriods = calculateLuckPeriods(chart, new Date(birthDate), gender);

            const resultDiv = document.getElementById('luckResult');
            resultDiv.innerHTML = `
                <div class="analysis-section">
                    <h3>The Great Cycles of Ten Years</h3>
                    ${luckPeriods.tenYear.map(period => `
                        <div style="background: rgba(30, 30, 30, 0.6); border: 1px solid rgba(120, 119, 198, 0.2); border-radius: 6px; padding: 20px; margin: 15px 0;">
                            <h4>Ages ${period.startAge} - ${period.endAge} (${period.startYear} - ${period.endYear})</h4>
                            <p><strong>Celestial Influence:</strong> ${period.stem.chinese}${period.branch.chinese} (${period.stem.element.toUpperCase()} ${period.branch.element.toUpperCase()})</p>
                            <p><strong>Season's Theme:</strong> ${period.theme}</p>
                            <p><strong>Natural Focus:</strong> ${period.keyAreas}</p>
                        </div>
                    `).join('')}
                </div>
                <div class="analysis-section">
                    <h3>The Current Year's Wisdom (2025)</h3>
                    <div style="background: rgba(30, 30, 30, 0.6); border: 1px solid rgba(120, 119, 198, 0.2); border-radius: 6px; padding: 20px; margin: 15px 0;">
                        <h4>Year of the Wood Snake (乙巳)</h4>
                        <p><strong>Universal Energy:</strong> Transformation through wisdom, strategic patience</p>
                        <p><strong>Personal Message:</strong> ${getCurrentYearAnalysis(chart)}</p>
                    </div>
                </div>
                
                <div class="sage-suggestion" onclick="askWisdom('What should I understand about my current life cycle?')">
                    ☯ "Ask the sage about flowing with your current life season"
                </div>
            `;
        }

        function calculateLuckPeriods(chart, birthDate, gender) {
            const birthYear = birthDate.getFullYear();
            const currentYear = 2025;
            const periods = [];
            
            for (let i = 0; i < 6; i++) {
                const startAge = i * 10 + 5;
                const endAge = startAge + 9;
                const startYear = birthYear + startAge;
                const endYear = birthYear + endAge;

                const stemIndex = (i + 2) % 10;
                const branchIndex = (i + 3) % 12;

                const stem = HEAVENLY_STEMS[stemIndex];
                const branch = EARTHLY_BRANCHES[branchIndex];

                periods.push({
                    startAge,
                    endAge,
                    startYear,
                    endYear,
                    stem,
                    branch,
                    theme: getLuckTheme(stem.element),
                    keyAreas: getLuckKeyAreas(stem.element)
                });
            }

            return {
                tenYear: periods.filter(p => p.startYear <= currentYear + 30)
            };
        }

        function getLuckTheme(element) {
            const themes = {
                wood: 'Growth, learning, new beginnings',
                fire: 'Recognition, passion, creative expression',
                earth: 'Stability, foundation-building, patience',
                metal: 'Structure, achievement, clarity of purpose',
                water: 'Wisdom, flexibility, spiritual deepening'
            };
            return themes[element] || 'Personal transformation';
        }

        function getLuckKeyAreas(element) {
            const areas = {
                wood: 'Career development, education, health cultivation',
                fire: 'Public recognition, relationships, creative projects',
                earth: 'Real estate, family matters, steady progress',
                metal: 'Business ventures, investments, organization',
                water: 'Travel, spirituality, communication, research'
            };
            return areas[element] || 'General life development';
        }

        function getCurrentYearAnalysis(chart) {
            const dayMaster = chart.day.stem.element;
            
            if (dayMaster === 'fire' || dayMaster === 'earth') {
                return 'The year\'s Wood energy nourishes your spirit. Growth and expansion flow naturally to you.';
            } else if (dayMaster === 'wood') {
                return 'Your essence feeds the year\'s energy. You find yourself in teaching or leadership roles.';
            } else if (dayMaster === 'metal') {
                return 'A year of gentle challenges that strengthen character. Like bamboo bending in wind, flexibility serves you.';
            } else {
                return 'A balanced year of steady progress. Neither forcing nor resisting, but flowing with natural rhythm.';
            }
        }

        function generateForecast() {
            const birthDate = document.getElementById('forecastBirthDate').value;
            const birthTime = document.getElementById('forecastBirthTime').value;
            const period = document.getElementById('forecastPeriod').value;

            const chart = calculateBaZi(birthDate, birthTime);
            currentChart = chart;
            const forecasts = period === 'daily' ? generateDailyForecast(chart) : generateMonthlyForecast(chart);

            const resultDiv = document.getElementById('forecastResult');
            resultDiv.innerHTML = `
                <div class="analysis-section">
                    <h3>The Flow of ${period === 'daily' ? 'Seven Days' : 'Six Moons'}</h3>
                    ${forecasts.map(forecast => `
                        <div style="background: rgba(30, 30, 30, 0.6); border: 1px solid rgba(120, 119, 198, 0.2); border-radius: 6px; padding: 15px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${forecast.date}</strong>
                                <div style="font-size: 14px; color: rgba(120, 219, 226, 0.7);">${forecast.pillar}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="margin: 10px 0;">${generateStarRating(forecast.rating)}</div>
                                <div style="font-size: 14px; margin-top: 5px; font-style: italic;">${forecast.advice}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="sage-suggestion" onclick="askWisdom('How should I flow with the current energies?')">
                    ☯ "Seek guidance on flowing with the present currents"
                </div>
            `;
        }

        function generateDailyForecast(chart) {
            const forecasts = [];
            const today = new Date();
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const dayMaster = chart.day.stem.element;
                let rating = 3;
                let advice = 'Flow with natural rhythm';
                
                // Simple forecast based on day of week and element
                if (i % 2 === 0 && dayMaster === 'wood') {
                    rating = 5;
                    advice = 'Perfect day for new beginnings';
                } else if (i % 3 === 0 && dayMaster === 'fire') {
                    rating = 4;
                    advice = 'Good day for creative expression';
                } else if (i === 6) {
                    rating = 2;
                    advice = 'Practice patience and inner stillness';
                } else if (dayMaster === 'water') {
                    rating = 4;
                    advice = 'Strong intuitive flow today';
                }
                
                forecasts.push({
                    date: `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}`,
                    pillar: `${HEAVENLY_STEMS[i % 10].chinese}${EARTHLY_BRANCHES[i % 12].chinese}`,
                    rating,
                    advice
                });
            }
            
            return forecasts;
        }

        function generateMonthlyForecast(chart) {
            const forecasts = [];
            const today = new Date();
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            for (let i = 0; i < 6; i++) {
                const date = new Date(today.getFullYear(), today.getMonth() + i, 1);
                const monthName = `${months[date.getMonth()]} ${date.getFullYear()}`;
                
                const dayMaster = chart.day.stem.element;
                let rating = 3;
                let advice = 'Steady progress in natural flow';
                
                // Simple forecast based on month and element
                if ((date.getMonth() + 1) % 4 === 0 && dayMaster === 'earth') {
                    rating = 5;
                    advice = 'Excellent month for stability and growth';
                } else if ((date.getMonth() + 1) % 3 === 0 && dayMaster === 'metal') {
                    rating = 4;
                    advice = 'Good month for organization and achievements';
                } else if (date.getMonth() === 11) {
                    rating = 2;
                    advice = 'Month of reflection - strength through yielding';
                }
                
                forecasts.push({
                    date: monthName,
                    pillar: `${HEAVENLY_STEMS[(date.getMonth() + 2) % 10].chinese}${EARTHLY_BRANCHES[(date.getMonth() + 3) % 12].chinese}`,
                    rating,
                    advice
                });
            }
            
            return forecasts;
        }
            const message = userMessage.toLowerCase();
            
            if (currentChart) {
                if (message.includes('essence') || message.includes('day master') || message.includes('nature')) {
                    const dayMaster = currentChart.day.stem;
                    return `Your essence is ${dayMaster.chinese}, the ${dayMaster.element} in its ${dayMaster.yin_yang} form. 

${getSageWisdom(dayMaster.element)}

Remember, child - you are not your chart, but the consciousness that observes it. The chart reveals tendencies, not absolutes. The Tao flows through all patterns yet remains beyond them.`;
                }
                
                if (message.includes('path') || message.includes('destiny') || message.includes('reveal') || message.includes('deeper')) {
                    return `☯ The Deep Currents of Your Destiny ☯

Your Four Pillars sing this song:
Year: ${currentChart.year.stem.chinese}${currentChart.year.branch.chinese} - how the world first knew you
Month: ${currentChart.month.stem.chinese}${currentChart.month.branch.chinese} - your worldly engagement  
Day: ${currentChart.day.stem.chinese}${currentChart.day.branch.chinese} - your eternal essence ☯
Hour: ${currentChart.hour.stem.chinese}${currentChart.hour.branch.chinese} - your hidden depths

${getSageWisdom(currentChart.day.stem.element)}

Remember - these are tendencies, not chains. The truly awakened person transcends their chart while honoring its wisdom. You are both the river and the consciousness that observes its flow.`;
                }
                
                if (message.includes('harmony') || message.includes('balance')) {
                    return `True harmony comes not from perfection but from acceptance. Like a garden where different flowers bloom in their own season, your elements each have their time and purpose.

The Tao teaches us: Water does not compete with fire for dominance, yet together they create the mist that nourishes all life.

To find balance, neither suppress your challenging elements nor cling to your strong ones. Simply observe them with compassion, like a sage watching clouds pass across the sky.`;
                }
            }
            
            if (message.includes('element') && message.includes('work')) {
                return `The Five Elements are like five notes in the eternal symphony - Wood grows, Fire transforms, Earth stabilizes, Metal refines, Water flows. Each feeds the next in the cycle of creation, each checks another in the cycle of balance.

Understanding comes not from memorizing their relationships but from feeling their rhythm within your own being. You are a microcosm of the universe, containing all elements in perfect potential.`;
            }
            
            if (message.includes('pillar')) {
                return `The Four Pillars are like four seasons of your existence:

Year Pillar - Spring of your being, how you first emerged into the world
Month Pillar - Summer of your power, how you engage with life's fullness
Day Pillar - Autumn of your essence, your true and unchanging nature
Hour Pillar - Winter of your wisdom, your private depths and future legacy

Together, they form the complete picture of your earthly journey. Yet remember - you are the observer of all pillars, the consciousness that transcends them all.`;
            }
            
            const sageResponses = [
                "The Tao that can be spoken is not the eternal Tao. Your question points to a truth that words cannot fully capture. Sit quietly with your chart, and let understanding arise naturally.",
                "Like water seeking its course, your question flows toward wisdom. Yet sometimes the most profound answers come not from words but from silent contemplation of the patterns heaven has written in your being.",
                "The sage teaches without teaching, leads without leading. Your chart is a mirror - it shows not what you must become, but what you already are. Look deeper, and you will find what you seek.",
                "In the space between question and answer, wisdom dwells. Your Four Pillars are signposts, not destinations. The true journey is always inward, toward the center that remains unchanged through all transformations.",
                "The wise person asks not what their destiny holds, but how to align with the natural flow of existence. Generate your chart first, and I will help you read the language of heaven written in your birth moment."
            ];
            
            return sageResponses[Math.floor(Math.random() * sageResponses.length)];
        }

        window.addEventListener('load', function() {
            setTimeout(() => {
                addSageMessage(`Welcome, seeker of wisdom. I am here to guide you through the ancient art of the Four Pillars, as water guides the river to the sea.

The charts you create reveal not your fate, but your nature. Like the moon reflected in still water, your true self can be seen when the mind becomes quiet.

Begin by revealing your Four Pillars, then return to sit with me in contemplation. The greatest truths are found not in complex calculations, but in simple understanding.

"The journey of a thousand miles begins with a single step."`);
            }, 500);
        });
    </script>
</body>
</html>
